(self.webpackChunkapp_frontend=self.webpackChunkapp_frontend||[]).push([[173],{15021:function(e,n,r){"use strict";var t=r(76747),a=r(86495),s=r(26319),l=r(71945),o=(0,t.P1)([a.Z.selectCurrentTenant,a.Z.selectCurrentUser],(function(e,n){return new s.Z(e,n).match(l.Z.values.userRead)})),i=(0,t.P1)([a.Z.selectCurrentTenant,a.Z.selectCurrentUser],(function(e,n){return new s.Z(e,n).match(l.Z.values.userEdit)})),u=(0,t.P1)([a.Z.selectCurrentTenant,a.Z.selectCurrentUser],(function(e,n){return new s.Z(e,n).match(l.Z.values.userDestroy)})),c={selectPermissionToRead:o,selectPermissionToEdit:i,selectPermissionToCreate:(0,t.P1)([a.Z.selectCurrentTenant,a.Z.selectCurrentUser],(function(e,n){return new s.Z(e,n).match(l.Z.values.userCreate)})),selectPermissionToImport:(0,t.P1)([a.Z.selectCurrentTenant,a.Z.selectCurrentUser],(function(e,n){return new s.Z(e,n).match(l.Z.values.userImport)})),selectPermissionToDestroy:u};n.Z=c},21538:function(e,n,r){"use strict";r(47313);var t=r(43270),a=r(49384),s=r(46417);function l(e){var n=e.label,r=e.name,l=e.hint,o=e.type,i=e.placeholder,u=e.autoFocus,c=e.autoComplete,d=e.required,m=e.externalErrorMessage,f=e.disabled,h=(0,t.Gc)(),p=h.register,g=h.errors,v=h.formState,x=v.touched,Z=v.isSubmitted,b=a.Z.errorMessage(r,g,x,Z,m);return(0,s.jsxs)("div",{className:"form-group",children:[Boolean(n)&&(0,s.jsx)("label",{className:"col-form-label ".concat(d?"required":null),htmlFor:r,children:n}),(0,s.jsx)("input",{id:r,name:r,type:o,ref:p,onChange:function(n){e.onChange&&e.onChange(n.target.value)},onBlur:function(n){e.onBlur&&e.onBlur(n)},placeholder:i||void 0,autoFocus:u||void 0,autoComplete:c||void 0,disabled:f,className:"form-control ".concat(b?"is-invalid":"")}),(0,s.jsx)("div",{className:"invalid-feedback",children:b}),Boolean(l)&&(0,s.jsx)("small",{className:"form-text text-muted",children:l})]})}l.defaultProps={type:"number",required:!1},n.Z=l},73173:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return ee}});var t=r(47313),a=r(45788),s=r(10499),l=r(13385),o=r(541),i=r(47921),u=r(27829),c=r(53852),d=r(75352),m=r(1413),f=r(36459),h=r(70885),p=r(43270),g=r(47575),v=r(5544),x=r(21538),Z=r(49384),b=r(61378),j=r.n(b),C=(r(72632),r(46417));function w(e){var n=e.label,r=e.name,a=e.hint,s=e.placeholder,l=e.autoFocus,o=e.externalErrorMessage,i=e.required,u=e.showTimeInput,c=e.scrollableYearDropdown,d=e.showYearDropdown,m=e.showMonthDropdown,f=(0,p.Gc)(),h=f.register,g=f.errors,v=f.formState,x=v.touched,b=v.isSubmitted,w=f.setValue,y=f.watch;(0,t.useEffect)((function(){h({name:r})}),[h,r]);var N=Z.Z.errorMessage(r,g,x,b,o);return(0,C.jsxs)("div",{className:"form-group",children:[Boolean(n)&&(0,C.jsx)("label",{className:"col-form-label ".concat(i?"required":null),htmlFor:r,children:n}),(0,C.jsx)("br",{}),(0,C.jsx)(j(),{id:r,name:r,className:"form-control ".concat(N?"is-invalid":""),onChange:function(n){w(r,n,{shouldValidate:!0,shouldDirty:!0}),e.onChange&&e.onChange(n)},onBlur:function(n){e.onBlur&&e.onBlur(n)},selected:y(r),showTimeInput:u,scrollableYearDropdown:c,showYearDropdown:d,showMonthDropdown:m,popperModifiers:{preventOverflow:{enabled:!0,escapeWithReference:!1}},placeholderText:s||"",autoFocus:l||void 0,autoComplete:"off",dateFormat:u?"yyyy-MM-dd HH:mm":"yyyy-MM-dd",timeIntervals:15}),(0,C.jsx)("div",{className:"invalid-feedback",children:N}),Boolean(a)&&(0,C.jsx)("small",{className:"form-text text-muted",children:a})]})}w.defaultProps={required:!1};var y=w,N=r(68160),S=r(95748),k=r(6473),M=r(89994),B=r(63442),D=r(67357),P=r(5284),T=r(70816),E=r.n(T),F=r(11550),V=r(42982),_=r(74773),q=r(74165),I=r(15861),A=r(1168),O=r(33512);var Y=function(e){var n=(0,t.useRef)(),r=(0,t.useState)(!1),a=(0,h.Z)(r,2),l=a[0],o=a[1];(0,t.useEffect)((function(){window.$(n.current).modal("show"),window.$(n.current).on("hidden.bs.modal",e.onClose)}),[]);var i=function(){var r=(0,I.Z)((0,q.Z)().mark((function r(t,a){var s,l;return(0,q.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,o(!0),r.next=4,_.Z.create(a);case 4:return r.next=6,_.Z.fetchUsers({email:a.emails[0]},null,1,0);case 6:s=r.sent,l=s.rows,window.$(n.current).modal("hide"),e.onSuccess(l[0]),r.next=15;break;case 12:r.prev=12,r.t0=r.catch(0),O.Z.handle(r.t0);case 15:return r.prev=15,o(!1),r.finish(15);case 18:case"end":return r.stop()}}),r,null,[[0,12,15,18]])})));return function(e,n){return r.apply(this,arguments)}}();return A.createPortal((0,C.jsx)("div",{ref:n,className:"modal",tabIndex:-1,children:(0,C.jsx)("div",{className:"modal-dialog modal-lg",children:(0,C.jsxs)("div",{className:"modal-content",children:[(0,C.jsxs)("div",{className:"modal-header",children:[(0,C.jsx)("h5",{className:"modal-title",children:(0,s.ag)("user.new.titleModal")}),(0,C.jsx)("button",{type:"button",className:"close","data-dismiss":"modal",children:(0,C.jsx)("span",{children:"\xd7"})})]}),(0,C.jsx)("div",{className:"modal-body",children:(0,C.jsx)(Q,{saveLoading:l,onSubmit:i,onCancel:function(){window.$(n.current).modal("hide")},modal:!0,single:!0})})]})})}),document.getElementById("modal-root"))},L=r(73622),R=r(35487),U=r.n(R);function G(e){var n=(0,p.Gc)(),r=n.errors,a=n.watch,l=n.setValue,o=n.register,i=n.formState,u=i.touched,c=i.isSubmitted,d=e.label,f=e.name,g=e.hint,v=e.placeholder,x=e.autoFocus,b=e.externalErrorMessage,j=e.mode,w=e.required,y=e.isClearable,N=e.mapper,S=e.fetchFn,k=e.election,M=a(f),B=(0,t.useState)([]),D=(0,h.Z)(B,2),P=D[0],T=D[1],E=(0,t.useState)(!1),F=(0,h.Z)(E,2),_=F[0],A=F[1];(0,t.useEffect)((function(){o({name:f})}),[o,f]),(0,t.useEffect)((function(){var e=function(){var e=(0,I.Z)((0,q.Z)().mark((function e(){var n;return(0,q.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return A(!0),e.prev=1,e.next=4,S();case 4:n=(n=e.sent).map((function(e){return N.toAutocomplete(e)})),T(n),A(!1),e.next=16;break;case 10:return e.prev=10,e.t0=e.catch(1),console.error(e.t0),T([]),A(!1),e.abrupt("return",[]);case 16:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(){return e.apply(this,arguments)}}();e().then((function(){}))}),[]);var O=function(e){return(P||[]).find((function(n){return n.value===e.value}))||e},Y=function(){return"multiple"===j?R():G()},R=function(){return M?M.map((function(e){return O(N.toAutocomplete(e))})):[]},G=function(){return M?O(N.toAutocomplete(M)):null},$=function(n){if(!n)return l(f,[],{shouldValidate:!0,shouldDirty:!0}),void(e.onChange&&e.onChange([]));var r=n.map((function(e){return N.toValue(e)}));l(f,r,{shouldValidate:!0,shouldDirty:!0}),e.onChange&&e.onChange(r)},H=function(n){if(!n)return l(f,null,{shouldValidate:!0,shouldDirty:!0}),void(e.onChange&&e.onChange(null));var r=N.toValue(n);l(f,r,{shouldValidate:!0,shouldDirty:!0}),e.onChange&&e.onChange(r)},X=_?(0,s.ag)("autocomplete.loading"):g,W=Z.Z.errorMessage(f,r,u,c,b),z=Boolean(W)?{control:function(e){return(0,m.Z)((0,m.Z)({},e),{},{borderColor:"red"})}}:void 0;return(0,C.jsxs)("div",{className:"form-group",children:[Boolean(d)&&(0,C.jsx)("label",{className:"col-form-label ".concat(w?"required":null),htmlFor:f,children:d}),(0,C.jsxs)("div",{style:{display:"flex"},children:[(0,C.jsx)(L.ZP,{className:"w-100",styles:z,id:f,name:f,isMulti:"multiple"===j,placeholder:v||"",autoFocus:x||void 0,onChange:function(e){return"multiple"===j?$(e):H(e)},value:Y(),isClearable:y,options:function(){var n=e.mode;return P?Y()?"multiple"===n?U()([].concat((0,V.Z)(P),(0,V.Z)(Y())),"value"):U()([].concat((0,V.Z)(P),[Y()]),"value"):P:[]}(),onBlur:function(n){e.onBlur&&e.onBlur(n)},loadingMessage:function(){return(0,s.ag)("autocomplete.loading")},noOptionsMessage:function(){return(0,s.ag)("autocomplete.noOptions")}}),k&&e.showCreate&&e.hasPermissionToCreate?(0,C.jsx)("button",{style:{marginLeft:"16px",flexShrink:0},className:"btn btn-primary",type:"button",onClick:e.onOpenModal,children:(0,C.jsx)("i",{className:"fas fa-plus"})}):null]}),(0,C.jsx)("div",{className:"invalid-feedback",children:W}),Boolean(X)&&(0,C.jsx)("small",{className:"form-text text-muted",children:X})]})}G.defaultProps={isClearable:!0,mode:"default",required:!1};var $=G,H=r(15021);var X=function(e){var n=(0,p.Gc)(),r=n.setValue,s=n.getValues,l=(0,t.useState)(!1),o=(0,h.Z)(l,2),i=o[0],u=o[1],c=(0,a.v9)(H.Z.selectPermissionToCreate);return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)($,(0,m.Z)((0,m.Z)({},e),{},{fetchFn:function(e,n){return _.Z.listAdherantAutocomplete(e,n)},mapper:{toAutocomplete:function(e){if(!e)return null;if(e.fullName||e.email){var n=e.email;return e.fullName&&(n="".concat(e.fullName," <").concat(e.email,">")),{value:e.id,label:n}}return{value:e.id,label:e.label}},toValue:function(e){return e?{id:e.value,label:e.label}:null}},onOpenModal:function(){return u(!0)},hasPermissionToCreate:c})),i&&(0,C.jsx)(Y,{visible:i,onClose:function(){return u(!1)},onSuccess:function(n){var t=e.name,a=e.mode;r(t,a&&"multiple"===a?[].concat((0,V.Z)(s()[t]||[]),[n]):n),u(!1)}})]})},W=r(63849),z=r(31616),J=k.Ry().shape({email:M.Z.email((0,s.ag)("user.fields.email")),roles:M.Z.stringArray((0,s.ag)("user.fields.roles"),{}),phoneNumber:M.Z.string((0,s.ag)("phoneNumber"),{max:24}),secteur:M.Z.enumerator((0,s.ag)("secteur"),{options:P.Z.secteur}),employeur:M.Z.string((0,s.ag)("Employeur"),{}),profession:M.Z.string((0,s.ag)("Profession"),{}),adresse:M.Z.string((0,s.ag)("adresse"),{}),fullName:M.Z.string((0,s.ag)("fullName"),{}),cin:M.Z.integer((0,s.ag)("cin"),{max:8}),date_naissance:M.Z.date((0,s.ag)("Date Naissance"),{}),etat_civil:M.Z.enumerator((0,s.ag)("user.fields.Etat_Civil"),{options:F.Z.Etat}),status:M.Z.enumerator((0,s.ag)("user.fields.status"),{options:B.Z.status}),lien_facebook:M.Z.string((0,s.ag)("Lien Facebook"),{}),parrain:M.Z.relationToOne((0,s.ag)("user.fields.parrain"),{})}),K=k.Ry().shape({emails:k.IX().label((0,s.ag)("user.fields.emails")).of(k.Z_().transform((function(e,n){return""===n?null:e})).email((0,s.ag)("user.validations.email")).label((0,s.ag)("user.fields.email")).max(255).required()).required().min(1),roles:M.Z.stringArray((0,s.ag)("user.fields.roles"),{required:!1})});var Q=function(e){e.single;var n=e.saveLoading,r=e.user||{},a=e.single?J:K,l=(0,t.useState)((function(){return{emails:[],email:"",roles:[],phoneNumber:"",secteur:"",employeur:"",profession:"",adresse:"",fullName:"",cin:"",date_naissance:r.date_naissance?E()(r.date_naissance,"DD-MM-YYYY").toDate():null,etat_civil:"",status:[""],lien_facebook:"",parrain:""}})),o=(0,h.Z)(l,1)[0],i=(0,p.cI)({resolver:(0,D.X)(a),mode:"all",defaultValues:o}),u=function(n){var r=Object.assign({},((0,f.Z)(n),n));r.roles[0]="membre",r.status="invited",r.parrain=r.parrain.id,r.email&&(r.emails=[r.email],delete r.email),e.onSubmit(null,r)},c=(0,t.useState)(new Date),d=(0,h.Z)(c,2);return d[0],d[1],(0,C.jsx)(N.Z,{children:(0,C.jsx)(p.RV,(0,m.Z)((0,m.Z)({},i),{},{children:(0,C.jsxs)("form",{onSubmit:i.handleSubmit(u),children:[(0,C.jsxs)(W.Z,{style:{paddingBottom:"10px"},children:[(0,C.jsx)(z.Z,{sm:4,children:(0,C.jsx)(g.Z,{name:"emails[0]",label:(0,s.ag)("user.fields.email"),required:!0})}),(0,C.jsx)(z.Z,{sm:4,children:(0,C.jsx)(g.Z,{name:"fullName",label:(0,s.ag)("user.fields.fullName"),required:!0})}),(0,C.jsx)(z.Z,{sm:4,children:(0,C.jsx)(g.Z,{name:"phoneNumber",label:(0,s.ag)("user.fields.phoneNumber"),autoComplete:"phoneNumber"})})]}),(0,C.jsxs)(W.Z,{children:[(0,C.jsx)(z.Z,{sm:4,children:(0,C.jsx)(v.Z,{name:"secteur",label:(0,s.ag)("user.fields.sector"),options:P.Z.secteur.map((function(e){return{value:e,label:(0,s.ag)("user.sector.".concat(e))}}))})}),(0,C.jsx)(z.Z,{sm:4,children:(0,C.jsx)(g.Z,{name:"employeur",label:(0,s.ag)("user.fields.employer")})}),(0,C.jsx)(z.Z,{sm:4,children:(0,C.jsx)(g.Z,{name:"profession",label:(0,s.ag)("user.fields.profession")})})]}),(0,C.jsxs)(W.Z,{style:{paddingBottom:"10px"},children:[(0,C.jsx)(z.Z,{sm:4,children:(0,C.jsx)(g.Z,{name:"adresse",label:(0,s.ag)("user.fields.address")})}),(0,C.jsx)(z.Z,{sm:4,children:(0,C.jsx)(x.Z,{name:"cin",label:(0,s.ag)("C.I.N")})}),(0,C.jsx)(z.Z,{sm:4,children:(0,C.jsx)(y,{name:"date_naissance",label:(0,s.ag)("user.fields.birthDate")})})]}),(0,C.jsxs)(W.Z,{children:[(0,C.jsx)(z.Z,{sm:4,children:(0,C.jsx)(v.Z,{name:"etat_civil",label:(0,s.ag)("user.fields.maritalStatus"),options:F.Z.Etat.map((function(e){return{value:e,label:(0,s.ag)("user.maritalStatus.".concat(e))}}))})}),(0,C.jsx)(z.Z,{sm:4,children:(0,C.jsx)(g.Z,{name:"lien_facebook",label:(0,s.ag)("user.fields.facebookLink")})}),(0,C.jsx)(z.Z,{sm:4,children:(0,C.jsx)(X,{name:"parrain",label:(0,s.ag)("user.fields.sponsor"),showCreate:!e.modal})})]}),(0,C.jsxs)("div",{className:"form-buttons",children:[(0,C.jsxs)("button",{className:"btn btn-primary",disabled:n,type:"button",onClick:i.handleSubmit(u),children:[(0,C.jsx)(S.Z,{loading:n,iconClass:"far fa-save"}),(0,s.ag)("common.save")]}),(0,C.jsxs)("button",{disabled:n,onClick:function(){Object.keys(o).forEach((function(e){i.setValue(e,o[e])}))},className:"btn btn-light",type:"button",children:[(0,C.jsx)("i",{className:"fas fa-undo"}),(0,s.ag)("common.reset")]}),e.onCancel?(0,C.jsxs)("button",{disabled:n,onClick:function(){return e.onCancel()},className:"btn btn-light",type:"button",children:[(0,C.jsx)("i",{className:"fas fa-times"}),(0,s.ag)("common.cancel")]}):null]})]})}))})};var ee=function(e){var n=(0,a.I0)(),r=(0,a.v9)(i.Z.selectSaveLoading);return(0,t.useEffect)((function(){n(o.Z.doInit())}),[n]),(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(c.Z,{items:[[(0,s.ag)("dashboard.menu"),"/"],[(0,s.ag)("user.menu"),"/user"],[(0,s.ag)("user.new.title")]]}),(0,C.jsxs)(u.Z,{children:[(0,C.jsx)(d.Z,{children:(0,s.ag)("user.new.title")}),(0,C.jsx)(Q,{saveLoading:r,onSubmit:function(e,r){n(o.Z.doAdd(r))},onCancel:function(){return(0,l.s1)().push("/user")}})]})]})}},34405:function(e,n,r){var t=r(99038);e.exports=function(e,n){return!!(null==e?0:e.length)&&t(e,n,0)>-1}},86722:function(e){e.exports=function(e,n,r){for(var t=-1,a=null==e?0:e.length;++t<a;)if(r(n,e[t]))return!0;return!1}},93527:function(e){e.exports=function(e,n,r,t){for(var a=e.length,s=r+(t?1:-1);t?s--:++s<a;)if(n(e[s],s,e))return s;return-1}},99038:function(e,n,r){var t=r(93527),a=r(57700),s=r(13245);e.exports=function(e,n,r){return n===n?s(e,n,r):t(e,a,r)}},57700:function(e){e.exports=function(e){return e!==e}},7579:function(e,n,r){var t=r(44526),a=r(34405),s=r(86722),l=r(88905),o=r(56946),i=r(73671);e.exports=function(e,n,r){var u=-1,c=a,d=e.length,m=!0,f=[],h=f;if(r)m=!1,c=s;else if(d>=200){var p=n?null:o(e);if(p)return i(p);m=!1,c=l,h=new t}else h=n?[]:f;e:for(;++u<d;){var g=e[u],v=n?n(g):g;if(g=r||0!==g?g:0,m&&v===v){for(var x=h.length;x--;)if(h[x]===v)continue e;n&&h.push(v),f.push(g)}else c(h,v,r)||(h!==f&&h.push(v),f.push(g))}return f}},56946:function(e,n,r){var t=r(4199),a=r(8568),s=r(73671),l=t&&1/s(new t([,-0]))[1]==1/0?function(e){return new t(e)}:a;e.exports=l},13245:function(e){e.exports=function(e,n,r){for(var t=r-1,a=e.length;++t<a;)if(e[t]===n)return t;return-1}},8568:function(e){e.exports=function(){}},35487:function(e,n,r){var t=r(81186),a=r(7579);e.exports=function(e,n){return e&&e.length?a(e,t(n,2)):[]}},72632:function(){},36459:function(e,n,r){"use strict";function t(e){if(null==e)throw new TypeError("Cannot destructure "+e)}r.d(n,{Z:function(){return t}})}}]);